
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="{{ asset('vendor/jquery-easing/jquery.easing.min.js') }}"></script>

<!-- Custom scripts for all pages-->
<script src="{{ asset('js/sb-admin-2.min.js') }}"></script>

<!-- Page level plugins -->
<script src="/vendor/chart.js/Chart.min.js"></script>

<!-- Page level custom scripts -->
<script src="/js/demo/chart-area-demo.js"></script>
<script src="/js/demo/chart-pie-demo.js"></script>

<script>

$(document).ready(function() {

    String.prototype.rtrim = function() {
        return this.replace(/\s+$/, "");
    }

        function inputUsername(inputData,input){
            let usernameData = inputData.rtrim();
            let usernameInput = input;

            if(usernameData.length < 1){
                usernameInput.after('<div class="erreur text-dark small" style="font-size: xx-small;">Le nom d\'utilisateur doit être de 3 caractères minimum et ne peux pas contenir d\'espace</div>');   
                
            }else{
                if(usernameData > 10) {
                    usernameInput.after('<div class="erreur text-dark small" style="font-size: xx-small;">Le nom d\'utilisateur doit être  moins de 10 caractères</div>');
                }
                return usernameData;
                
            }
        }//  verify username

    const reset = () => {
        $(".btn_submit").attr("disabled", false);
        $(".btn_submit").css("background-color", "#EF0051");
        $(".btn_submit").hover(() => { $(".btn_submit").css("background-color", "#D31052") })
    };

    const disable = () => {
        $(".btn_submit").attr("disabled", true);
        $(".btn_submit").css("background-color", "gray");
    }

    let firebaseConfig;
    let downloadUrl;

    
    const token = localStorage.getItem("token");
    let idChannel = localStorage.getItem("userChannelId");

    if(token !== "") {

        $.ajax({
            type: "POST", 
            url: "/admin/channel/edit/show", 
            data: JSON.stringify({
                "token": token,
                "idChannel": idChannel,
            }),
            dataType: 'json',
            async: true,
            success: function(response) {
                reset();

                if(response != undefined){

                }

                console.log(response);
            },
            error: function (error) {

                reset();
                console.log(error);
            }
        });
    }

    $.ajax({
    method: "GET", 
    url: "/firebase", 
    async: true,
    success: function(data) {
    //console.log(data.apiKey+" "+data.authDomain+" "+data.databaseURL+" "+data.projectId+" "+data.storageBucket);
    
        firebaseConfig = {
            apiKey: data.apiKey,
            authDomain: data.authDomain,
            databaseURL: data.databaseURL,
            projectId: data.projectId,
            storageBucket: data.storageBucket
        };


        firebase.initializeApp(firebaseConfig);

        // On détecte le changement de fichier
        $('#cameraInput').on('change', function() {
            // On récupère le nouveau fichier
            let selectedFile = event.target.files[0];

        
            let filename = $('#cameraInput').val().replace(/C:\\fakepath\\/i, '');
            let storageRef = firebase.storage().ref('/User/channel' + filename);

            // On envoi le fichier à Firebase
            let upload = storageRef.put(selectedFile);

            // Le traitement Firebase se fait ici
            upload.on('state_changed', function(snapshot) {

            }, function(error) {
                // Si Firebase renvoi une error on l'a met ici
                console.log(error)
            }, function() {
                // On récupère l'URL téléchargeable
                downloadUrl = upload.snapshot.downloadURL;
                // On l'affiche
                 console.log(downloadUrl);
            
                // On remplace l'URL de l'image par la nouvelle
                    $('#profil').attr('src', downloadUrl);
                    $('#logo-setting').attr('src', downloadUrl) 

            });
        });// change profil 



        $('#button-settingsAdmin').click(function(e){
                e.preventDefault();
                disable();

                let channels = $('#channels').val();
                let inputChannel = $('#channels');

                let profil = $('#profil').attr('src');

                let channelName = inputEmail(channels,inputChannel);

             if(token !== "" || channelName !== undefined){
                        

                $.ajax({
                    type: "POST", 
                    url: "/admin/channel/edit/update", 
                    data: JSON.stringify({
                        "token": token,
                        "avatar": profil,
                        "channelName": channelName,
                    }),
                    dataType: 'json',
                    async: true,
                    success: function(response) {
                        reset();

                        console.log(response);
                    },
                    error: function (error) {

                        reset();
                        console.log(error);
                    }
                });

            }//if

        });  //fin 

    }

    });

    
});
</script>